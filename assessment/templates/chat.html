{% extends "base.html" %}
{% block title %}Chat — DIT 2026{% endblock %}

{% block content %}
<div class="chat-container">
    <div class="chat-header">
        <h2>Chat with the Framework</h2>
        {% if has_llm %}
        <div class="model-bar">
            <div class="model-bar-group">
                <label for="providerSelect">Provider</label>
                <select id="providerSelect">
                    {% for p in providers %}
                    <option value="{{ p.name }}" {% if not p.available %}disabled{% endif %}>
                        {{ p.name | capitalize }} {% if not p.available %}— unavailable{% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="model-bar-group">
                <label for="modelSelect">Model</label>
                <select id="modelSelect">
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="model-bar-group" id="reasoningGroup" style="display:none;">
                <label for="reasoningSelect" id="reasoningLabel">Reasoning</label>
                <select id="reasoningSelect"></select>
            </div>
        </div>
        {% endif %}
    </div>

    {% if not has_llm %}
    <div class="chat-demo-notice">
        <h3>RAG Chat — Run Locally</h3>
        <p>This feature uses retrieval-augmented generation to let you have a conversation grounded in the framework text. It supports OpenAI, Anthropic, Google, and local Ollama models.</p>
        <p>To try it, clone the repo and run locally:</p>
        <pre><code>git clone https://github.com/aji-ai/dit-2026.git
cd dit-2026/assessment
pip install -r requirements.txt
python __main__.py</code></pre>
        <p>When running locally, a <strong>Settings</strong> page appears in the navigation where you can configure your API key.</p>
        <p>The chat component is built as a reusable RAG module&mdash;fork the repo to embed framework-grounded chat in your own tools and workflows.</p>
        <a href="https://github.com/aji-ai/dit-2026" class="btn btn-primary" target="_blank">View on GitHub</a>
    </div>
    {% else %}
    <div class="chat-messages" id="chatMessages">
        <div class="message assistant">
            <div class="message-content">
                <p>Welcome! I'm here to help you understand the <strong>E-P-I-A-S &times; SAE Framework</strong> from John Maeda's Design in Tech Report 2026.</p>
                <p>You can ask me about:</p>
                <ul>
                    <li>What different SAE levels mean for designers</li>
                    <li>How to grow within your current level</li>
                    <li>Transition strategies (e.g., L2 &rarr; L3)</li>
                    <li>Tools and practices at each level</li>
                    <li>The difference between depth and breadth</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="chat-input-area">
        <div class="suggested-questions" id="suggestions">
            <button class="suggestion" data-q="What SAE level am I at if I use ChatGPT daily but rewrite everything?">What level is daily ChatGPT use?</button>
            <button class="suggestion" data-q="How do I move from L2 to L3?">How to move L2 &rarr; L3?</button>
            <button class="suggestion" data-q="Is depth at L1 better than breadth at L4?">Depth vs breadth?</button>
            <button class="suggestion" data-q="What tools do designers use at L3?">L3 tools?</button>
        </div>
        <form id="chatForm" class="chat-form">
            <input type="text" id="chatInput" placeholder="Ask about the framework..." autocomplete="off">
            <button type="submit" class="btn btn-primary" id="sendBtn">Send</button>
        </form>
        <div class="chat-meta" id="chatMeta"></div>
    </div>

    <!-- Sources data kept in response but not displayed -->
    <div id="sourcesPanel" style="display:none;"><div id="sourcesList"></div></div>
    {% endif %}
</div>

<script src="{{ url_for('static', filename='chat.js') }}"></script>
{% endblock %}
